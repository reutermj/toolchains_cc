#!/bin/bash
set -euox pipefail

export BUILD_ARCH=${TARGET%%-*}

# Linux kernel ARCH values differ from GNU triplet arch names
case ${BUILD_ARCH} in
    x86_64)  export LINUX_ARCH="x86" ;;
    aarch64) export LINUX_ARCH="arm64" ;;
esac

export SYSROOT_DIR="/tmp/sysroot"
export ARTIFACTS_DIR="/tmp/artifacts"
export GLIBC_SOURCE="/tmp/glibc-source"
export LINUX_SOURCE="/tmp/linux-source"
export GLIBC_ARTIFACTS="/tmp/glibc-artifacts"

mkdir -p "${SYSROOT_DIR}"
mkdir -p "${ARTIFACTS_DIR}"
mkdir -p "${GLIBC_SOURCE}"
mkdir -p "${LINUX_SOURCE}"
mkdir -p "${GLIBC_ARTIFACTS}"

# Export to GitHub Actions environment if running in CI
if [ -n "${GITHUB_ENV:-}" ]; then
    echo "ARTIFACTS_DIR=${ARTIFACTS_DIR}" >> "${GITHUB_ENV}"
fi
