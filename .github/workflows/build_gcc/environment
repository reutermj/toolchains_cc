#!/bin/bash
set -euox pipefail

# Derive BOOTSTRAP from the target triple's vendor field.
# Targets with "bootstrap" in the vendor (e.g., x86_64-bootstrap-linux-gnu)
# produce a minimal C-only compiler for building libc.
if [[ "${TARGET}" == *-bootstrap-* ]]; then
    export BOOTSTRAP="true"
else
    export BOOTSTRAP="false"
fi

# ==============================
# || Setup Source Directories ||
# ==============================
export GMP_SOURCE="/tmp/gmp-source"
export MPFR_SOURCE="/tmp/mpfr-source"
export ISL_SOURCE="/tmp/isl-source"
export MPC_SOURCE="/tmp/mpc-source"
export GCC_SOURCE="/tmp/gcc-source"
export LINUX_SOURCE="/tmp/linux-source"

mkdir -p ${GMP_SOURCE}
mkdir -p ${MPFR_SOURCE}
mkdir -p ${ISL_SOURCE}
mkdir -p ${MPC_SOURCE}
mkdir -p ${GCC_SOURCE}
mkdir -p ${LINUX_SOURCE}

# ==============================
# || Setup Output Directories ||
# ==============================
export BUILD_TOOLS="/tmp/buildtools"
export GCC_ARTIFACTS="/tmp/gcc-artifacts"
export ARTIFACTS_DIR="/tmp/artifacts"

mkdir -p ${BUILD_TOOLS}
mkdir -p ${GCC_ARTIFACTS}
mkdir -p ${ARTIFACTS_DIR}

# Ensures that ARTIFACTS_DIR is available to provinance attestation in
# the github actions workflow.
if [ -n "${GITHUB_ENV:-}" ]; then
    echo "ARTIFACTS_DIR=${ARTIFACTS_DIR}" >> "${GITHUB_ENV}"
fi
